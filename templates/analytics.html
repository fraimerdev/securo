{% extends "base.html" %}

{% block title %}Enhanced Crime Analytics Dashboard{% endblock %}

{% block header %}CRIME ANALYTICS DASHBOARD{% endblock %}

{% block content %}
<style>
    /* ANALYTICS DASHBOARD STYLES - St. Kitts & Nevis Flag Colors */
    .analytics-dashboard {
        display: flex;
        flex-direction: column;
        gap: 30px;
        padding: 0;
    }

    /* Enhanced Status Header */
    .status-header {
        background: linear-gradient(135deg, rgba(0, 166, 81, 0.1) 0%, rgba(0, 166, 81, 0.05) 100%);
        border: 2px solid rgba(0, 166, 81, 0.3);
        border-radius: 12px;
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
        flex-wrap: wrap;
        gap: 20px;
        position: relative;
        overflow: hidden;
    }

    .status-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-green), var(--secondary-green));
    }

    .status-left {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .live-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--success);
        font-weight: 700;
        font-size: 0.9rem;
        letter-spacing: 1px;
    }

    .pulse-dot {
        width: 12px;
        height: 12px;
        background: var(--success);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
    }

    .last-update {
        color: var(--text-gray);
        font-size: 0.8rem;
    }

    .status-center {
        flex: 1;
        display: flex;
        justify-content: center;
    }

    .year-selection-panel {
        background: rgba(0, 166, 81, 0.1);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 12px;
        padding: 20px 25px;
        display: flex;
        align-items: center;
        gap: 25px;
        backdrop-filter: blur(5px);
        flex-wrap: wrap;
    }

    .year-selector {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .year-selector label {
        color: var(--primary-green);
        font-size: 0.8rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .year-dropdown {
        background: var(--dark-gray);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 6px;
        padding: 10px 15px;
        color: var(--text-white);
        font-weight: 600;
        font-size: 0.9rem;
        min-width: 90px;
        text-align: center;
        transition: var(--transition);
    }

    .year-dropdown:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 2px rgba(0, 166, 81, 0.2);
    }

    .update-btn {
        background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        color: #ffffff;
        font-weight: 700;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
    }

    .update-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 166, 81, 0.3);
    }

    .status-right {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .system-status {
        display: flex;
        gap: 15px;
    }

    .status-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .status-item.online {
        background: rgba(0, 166, 81, 0.1);
        color: var(--primary-green);
        border: 1px solid var(--primary-green);
    }

    .status-item i {
        font-size: 14px;
    }

    /* Command Overview */
    .command-overview {
        background: linear-gradient(135deg, rgba(0, 166, 81, 0.05) 0%, rgba(0, 166, 81, 0.02) 100%);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 12px;
        padding: 30px;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .command-overview::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-green), var(--secondary-green));
    }

    .overview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
        flex-wrap: wrap;
        gap: 20px;
    }

    .overview-header h2 {
        font-size: 1.8rem;
        font-weight: 900;
        color: var(--primary-green);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .analysis-controls {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .time-selector {
        display: flex;
        gap: 5px;
        background: var(--dark-gray);
        border-radius: 8px;
        padding: 5px;
        border: 1px solid rgba(0, 166, 81, 0.2);
    }

    .time-btn {
        background: transparent;
        border: none;
        color: var(--text-gray);
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: var(--transition);
        text-transform: uppercase;
    }

    .time-btn.active,
    .time-btn:hover {
        background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
        color: #ffffff;
    }

    .export-controls {
        display: flex;
        gap: 10px;
    }

    .export-btn {
        background: rgba(0, 166, 81, 0.1);
        border: 1px solid var(--primary-green);
        border-radius: 6px;
        padding: 8px 12px;
        color: var(--primary-green);
        font-size: 0.8rem;
        font-weight: 700;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .export-btn:hover {
        background: rgba(0, 166, 81, 0.2);
        transform: translateY(-1px);
    }

    /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }

    .metric-card {
        background: linear-gradient(145deg, rgba(0, 166, 81, 0.05), rgba(0, 166, 81, 0.02));
        border: 1px solid rgba(0, 166, 81, 0.2);
        border-radius: 12px;
        padding: 25px;
        backdrop-filter: blur(5px);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
    }

    .metric-card:hover {
        transform: translateY(-5px);
        border-color: rgba(0, 166, 81, 0.4);
        box-shadow: 0 15px 40px rgba(0, 166, 81, 0.1);
    }

    .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .metric-icon {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: var(--text-white);
    }

    .metric-card.critical .metric-icon {
        background: linear-gradient(135deg, #E31E24, #FF2E34);
    }

    .metric-card.high .metric-icon {
        background: linear-gradient(135deg, #FFD700, #FFED4E);
        color: #000000;
    }

    .metric-card.medium .metric-icon {
        background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
        color: #ffffff;
    }

    .metric-card.success .metric-icon {
        background: linear-gradient(135deg, var(--primary-green), #00C760);
        color: #ffffff;
    }

    .metric-status {
        text-align: right;
    }

    .status-label {
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        color: var(--text-gray);
        margin-bottom: 5px;
        display: block;
    }

    .trend-indicator {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.8rem;
        font-weight: 700;
    }

    .trend-indicator.down {
        color: var(--primary-green);
    }

    .trend-indicator.up {
        color: #E31E24;
    }

    .metric-content {
        margin-bottom: 20px;
    }

    .metric-number {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--text-white);
        line-height: 1;
        margin-bottom: 8px;
    }

    .metric-label {
        color: var(--text-gray);
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .metric-detail {
        color: var(--text-dim);
        font-size: 0.8rem;
        line-height: 1.4;
    }

    .metric-chart {
        height: 40px;
        position: relative;
    }

    /* Comparison Section */
    .comparison-section {
        background: linear-gradient(135deg, rgba(0, 166, 81, 0.05) 0%, rgba(0, 166, 81, 0.02) 100%);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 12px;
        padding: 30px;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .comparison-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-green), var(--secondary-green));
    }

    .comparison-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
        flex-wrap: wrap;
        gap: 20px;
    }

    .comparison-header h2 {
        font-size: 1.6rem;
        font-weight: 900;
        color: var(--primary-green);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .comparison-controls {
        display: flex;
        gap: 5px;
        background: var(--dark-gray);
        border-radius: 8px;
        padding: 5px;
        border: 1px solid rgba(0, 166, 81, 0.2);
    }

    .comparison-btn {
        background: transparent;
        border: none;
        color: var(--text-gray);
        padding: 10px 16px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 6px;
        text-transform: uppercase;
    }

    .comparison-btn.active,
    .comparison-btn:hover {
        background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
        color: #ffffff;
    }

    .comparison-content {
        position: relative;
    }

    .comparison-view {
        display: none;
    }

    .comparison-view.active {
        display: block;
    }

    /* Chart Styles */
    .chart-panel {
        background: rgba(0, 166, 81, 0.05);
        border: 1px solid rgba(0, 166, 81, 0.2);
        border-radius: 12px;
        padding: 25px;
        backdrop-filter: blur(5px);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
        flex-wrap: wrap;
        gap: 15px;
    }

    .chart-header h3 {
        color: var(--primary-green);
        font-weight: 900;
        font-size: 1.2rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .chart-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .chart-select {
        background: var(--dark-gray);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 6px;
        padding: 8px 12px;
        color: var(--text-white);
        font-size: 0.8rem;
        font-weight: 600;
        transition: var(--transition);
    }

    .chart-select:focus {
        outline: none;
        border-color: var(--primary-green);
    }

    .chart-container.large {
        height: 400px;
        position: relative;
        margin-bottom: 20px;
    }

    .chart-container.medium {
        height: 300px;
        position: relative;
    }

    /* Enhanced Tables */
    .tables-section {
        background: linear-gradient(135deg, rgba(0, 166, 81, 0.05) 0%, rgba(0, 166, 81, 0.02) 100%);
        border: 1px solid rgba(0, 166, 81, 0.3);
        border-radius: 12px;
        padding: 30px;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .tables-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-green), var(--secondary-green));
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
        flex-wrap: wrap;
        gap: 20px;
    }

    .section-header h2 {
        font-size: 1.6rem;
        font-weight: 900;
        color: var(--primary-green);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .table-card {
        background: rgba(0, 166, 81, 0.05);
        border: 1px solid rgba(0, 166, 81, 0.2);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
    }

    .table-header h3 {
        color: var(--primary-green);
        font-weight: 900;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .analytics-table {
        width: 100%;
        border-collapse: collapse;
    }

    .analytics-table th {
        background: var(--dark-gray);
        color: var(--primary-green);
        padding: 15px 20px;
        text-align: left;
        font-weight: 700;
        font-size: 0.8rem;
        letter-spacing: 1px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.2);
        text-transform: uppercase;
    }

    .analytics-table td {
        padding: 15px 20px;
        border-bottom: 1px solid rgba(0, 166, 81, 0.1);
        color: var(--text-white);
        font-size: 0.9rem;
    }

    .analytics-table tr:hover {
        background: rgba(0, 166, 81, 0.05);
    }

    .crime-type {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .crime-type i {
        color: var(--primary-green);
        width: 20px;
    }

    .change-percent.down {
        color: var(--primary-green);
        font-weight: 700;
    }

    .change-percent.up {
        color: #E31E24;
        font-weight: 700;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .status-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .status-center {
            justify-content: center;
        }
    }

    @media (max-width: 768px) {
        .year-selection-panel {
            flex-direction: column;
            gap: 15px;
            align-items: stretch;
        }
        
        .overview-header,
        .comparison-header,
        .section-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .analysis-controls,
        .comparison-controls {
            justify-content: center;
        }
        
        .system-status {
            justify-content: center;
            flex-wrap: wrap;
        }
    }
</style>

<div class="analytics-dashboard">
    <!-- Enhanced Status Header with Year Selection -->
    <div class="status-header">
        <div class="status-left">
            <div class="live-indicator">
                <div class="pulse-dot"></div>
                <span>MULTI-YEAR DATA STREAM</span>
            </div>
            <div class="last-update">
                Last Updated: <span id="lastUpdateTime">Loading...</span>
            </div>
        </div>
        <div class="status-center">
            <div class="year-selection-panel">
                <div class="year-selector">
                    <label>Primary Year:</label>
                    <select id="primaryYear" class="year-dropdown">
                        <option value="2024" selected>2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                        <option value="2019">2019</option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                    </select>
                </div>
                <div class="year-selector">
                    <label>Compare With:</label>
                    <select id="compareYear" class="year-dropdown">
                        <option value="">None</option>
                        <option value="2023" selected>2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                        <option value="2019">2019</option>
                        <option value="2018">2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                    </select>
                </div>
                <button id="updateAnalytics" class="update-btn">
                    <i class="fas fa-sync-alt"></i>
                    UPDATE ANALYSIS
                </button>
            </div>
        </div>
        <div class="status-right">
            <div class="system-status">
                <div class="status-item online">
                    <i class="fas fa-database"></i>
                    <span>DATABASE</span>
                </div>
                <div class="status-item online">
                    <i class="fas fa-chart-line"></i>
                    <span>ANALYTICS</span>
                </div>
                <div class="status-item online">
                    <i class="fas fa-shield-alt"></i>
                    <span>SECURITY</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Command Center Overview -->
    <div class="command-overview">
        <div class="overview-header">
            <h2>MULTI-YEAR TACTICAL OVERVIEW</h2>
            <div class="analysis-controls">
                <div class="time-selector">
                    <button class="time-btn active" data-period="current">CURRENT</button>
                    <button class="time-btn" data-period="trend">TREND</button>
                    <button class="time-btn" data-period="forecast">FORECAST</button>
                </div>
                <div class="export-controls">
                    <button class="export-btn" id="exportPDF">
                        <i class="fas fa-file-pdf"></i>
                        PDF REPORT
                    </button>
                    <button class="export-btn" id="exportExcel">
                        <i class="fas fa-file-excel"></i>
                        EXCEL DATA
                    </button>
                </div>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card critical">
                <div class="metric-header">
                    <div class="metric-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-status">
                        <span class="status-label" id="totalCrimesStatus">ANALYSIS</span>
                        <div class="trend-indicator down" id="totalCrimesTrend">
                            <i class="fas fa-arrow-down"></i>
                            <span id="totalCrimesChange">-11%</span>
                        </div>
                    </div>
                </div>
                <div class="metric-content">
                    <div class="metric-number" id="totalIncidents">1,127</div>
                    <div class="metric-label">TOTAL INCIDENTS (<span id="totalIncidentsYear">2024</span>)</div>
                    <div class="metric-detail" id="totalIncidentsDetail">1,127 vs 1,266 previous year (-11%)</div>
                </div>
                <div class="metric-chart">
                    <canvas id="totalIncidentsChart" width="100" height="40"></canvas>
                </div>
            </div>

            <div class="metric-card critical">
                <div class="metric-header">
                    <div class="metric-icon">
                        <i class="fas fa-skull-crossbones"></i>
                    </div>
                    <div class="metric-status">
                        <span class="status-label" id="homicidesStatus">MONITORED</span>
                        <div class="trend-indicator down" id="homicidesTrend">
                            <i class="fas fa-arrow-down"></i>
                            <span id="homicidesChange">-10%</span>
                        </div>
                    </div>
                </div>
                <div class="metric-content">
                    <div class="metric-number" id="totalHomicides">28</div>
                    <div class="metric-label">HOMICIDES (<span id="homicidesYear">2024</span>)</div>
                    <div class="metric-detail" id="homicidesDetail">28 vs 31 previous year (-10%)</div>
                </div>
                <div class="metric-chart">
                    <canvas id="homicidesChart" width="100" height="40"></canvas>
                </div>
            </div>

            <div class="metric-card high">
                <div class="metric-header">
                    <div class="metric-icon">
                        <i class="fas fa-stopwatch"></i>
                    </div>
                    <div class="metric-status">
                        <span class="status-label" id="responseStatus">OPTIMAL</span>
                        <div class="trend-indicator down" id="responseTrend">
                            <i class="fas fa-arrow-down"></i>
                            <span id="responseChange">-9%</span>
                        </div>
                    </div>
                </div>
                <div class="metric-content">
                    <div class="metric-number" id="responseTime">8.3</div>
                    <div class="metric-label">AVG RESPONSE (MIN)</div>
                    <div class="metric-detail" id="responseDetail">Target: 8min | Status: ACHIEVED</div>
                </div>
                <div class="metric-chart">
                    <canvas id="responseChart" width="100" height="40"></canvas>
                </div>
            </div>

            <div class="metric-card success">
                <div class="metric-header">
                    <div class="metric-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="metric-status">
                        <span class="status-label" id="clearanceStatus">EXCELLENT</span>
                        <div class="trend-indicator up" id="clearanceTrend">
                            <i class="fas fa-arrow-up"></i>
                            <span id="clearanceChange">+8%</span>
                        </div>
                    </div>
                </div>
                <div class="metric-content">
                    <div class="metric-number" id="clearanceRate">89%</div>
                    <div class="metric-label">CASE CLEARANCE RATE</div>
                    <div class="metric-detail" id="clearanceDetail">Regional best practice standard</div>
                </div>
                <div class="metric-chart">
                    <canvas id="clearanceChart" width="100" height="40"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Multi-Year Comparison Section -->
    <div class="comparison-section">
        <div class="comparison-header">
            <h2>MULTI-YEAR CRIME ANALYSIS</h2>
            <div class="comparison-controls">
                <button class="comparison-btn active" data-view="trends">
                    <i class="fas fa-chart-line"></i>
                    TRENDS
                </button>
                <button class="comparison-btn" data-view="breakdown">
                    <i class="fas fa-chart-pie"></i>
                    BREAKDOWN
                </button>
                <button class="comparison-btn" data-view="forecast">
                    <i class="fas fa-crystal-ball"></i>
                    FORECAST
                </button>
            </div>
        </div>

        <div class="comparison-content">
            <!-- Crime Trends Analysis -->
            <div class="comparison-view active" id="trendsView">
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3>CRIME TRENDS ANALYSIS (2016-2024)</h3>
                        <div class="chart-controls">
                            <select id="trendType" class="chart-select">
                                <option value="total">Total Crimes</option>
                                <option value="violent">Violent Crimes</option>
                                <option value="property">Property Crimes</option>
                                <option value="drug">Drug Offenses</option>
                                <option value="homicides">Homicides</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container large">
                        <canvas id="multiYearTrendsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Crime Breakdown Analysis -->
            <div class="comparison-view" id="breakdownView">
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3>CRIME TYPE DISTRIBUTION</h3>
                        <div class="chart-controls">
                            <select id="breakdownYear" class="chart-select">
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container medium">
                        <canvas id="crimeBreakdownChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Crime Forecast -->
            <div class="comparison-view" id="forecastView">
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3>CRIME FORECAST ANALYSIS</h3>
                        <div class="chart-controls">
                            <select id="forecastType" class="chart-select">
                                <option value="total">Total Crimes</option>
                                <option value="violent">Violent Crimes</option>
                                <option value="homicides">Homicides</option>
                            </select>
                            <select id="forecastPeriod" class="chart-select">
                                <option value="6">6 Months</option>
                                <option value="12" selected>12 Months</option>
                                <option value="24">24 Months</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container large">
                        <canvas id="crimeForecastChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Data Tables Section -->
    <div class="tables-section">
        <div class="section-header">
            <h2>DETAILED MULTI-YEAR ANALYTICS</h2>
        </div>

        <div class="table-card" id="crimesTable">
            <div class="table-header">
                <h3>MULTI-YEAR CRIME CATEGORIES</h3>
                <div class="table-period">Historical Analysis (2016-2024)</div>
            </div>
            <div class="table-container">
                <table class="analytics-table">
                    <thead>
                        <tr>
                            <th>CRIME TYPE</th>
                            <th>2024</th>
                            <th>2023</th>
                            <th>2022</th>
                            <th>2021</th>
                            <th>2020</th>
                            <th>5-YR CHANGE</th>
                        </tr>
                    </thead>
                    <tbody id="crimesTableBody">
                        <!-- Data populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
    // Historical crime data (2016-2024)
    const historicalData = {
        "2024": {
            "total_crimes": 1127, "homicides": 28, "violent_crimes": 234, "property_crimes": 412,
            "drug_offenses": 156, "fraud": 67, "theft": 134, "sexual_offenses": 72,
            "clearance_rate": 89, "response_time": 8.3
        },
        "2023": {
            "total_crimes": 1266, "homicides": 31, "violent_crimes": 267, "property_crimes": 456,
            "drug_offenses": 178, "fraud": 78, "theft": 156, "sexual_offenses": 68,
            "clearance_rate": 82, "response_time": 9.1
        },
        "2022": {
            "total_crimes": 1360, "homicides": 34, "violent_crimes": 298, "property_crimes": 487,
            "drug_offenses": 189, "fraud": 89, "theft": 167, "sexual_offenses": 71,
            "clearance_rate": 78, "response_time": 9.8
        },
        "2021": {
            "total_crimes": 1289, "homicides": 32, "violent_crimes": 287, "property_crimes": 465,
            "drug_offenses": 167, "fraud": 82, "theft": 145, "sexual_offenses": 65,
            "clearance_rate": 75, "response_time": 10.2
        },
        "2020": {
            "total_crimes": 1156, "homicides": 29, "violent_crimes": 245, "property_crimes": 398,
            "drug_offenses": 145, "fraud": 67, "theft": 123, "sexual_offenses": 52,
            "clearance_rate": 71, "response_time": 11.5
        },
        "2019": {
            "total_crimes": 1287, "homicides": 33, "violent_crimes": 289, "property_crimes": 445,
            "drug_offenses": 178, "fraud": 73, "theft": 156, "sexual_offenses": 58,
            "clearance_rate": 68, "response_time": 12.1
        },
        "2018": {
            "total_crimes": 1345, "homicides": 36, "violent_crimes": 312, "property_crimes": 467,
            "drug_offenses": 189, "fraud": 78, "theft": 167, "sexual_offenses": 61,
            "clearance_rate": 65, "response_time": 13.2
        },
        "2017": {
            "total_crimes": 1398, "homicides": 34, "violent_crimes": 325, "property_crimes": 489,
            "drug_offenses": 198, "fraud": 82, "theft": 178, "sexual_offenses": 63,
            "clearance_rate": 62, "response_time": 14.1
        },
        "2016": {
            "total_crimes": 1423, "homicides": 32, "violent_crimes": 334, "property_crimes": 501,
            "drug_offenses": 203, "fraud": 85, "theft": 189, "sexual_offenses": 65,
            "clearance_rate": 59, "response_time": 15.3
        }
    };

    // Chart instances
    let multiYearTrendsChart = null;
    let crimeBreakdownChart = null;
    let crimeForecastChart = null;
    let totalIncidentsChart = null;
    let homicidesChart = null;
    let responseChart = null;
    let clearanceChart = null;

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Enhanced Multi-Year Analytics Dashboard Initializing...');
        
        // Initialize dashboard
        initializeDashboard();
        setupEventListeners();
        updateLastUpdateTime();
        loadInitialData();
        
        console.log('Dashboard initialized successfully');
    });

    function initializeDashboard() {
        // Initialize charts
        initializeMetricCharts();
        initializeMultiYearTrendsChart();
        initializeCrimeBreakdownChart();
        initializeCrimeForecast();
        
        // Load initial data
        updateMetricsForYear('2024', '2023');
        updateCrimesTable();
    }

    function setupEventListeners() {
        // Year selection
        document.getElementById('primaryYear').addEventListener('change', handleYearChange);
        document.getElementById('compareYear').addEventListener('change', handleYearChange);
        document.getElementById('updateAnalytics').addEventListener('click', updateAnalytics);
        
        // View switching
        document.querySelectorAll('.comparison-btn').forEach(btn => {
            btn.addEventListener('click', switchComparisonView);
        });
        
        // Chart controls
        document.getElementById('trendType').addEventListener('change', updateTrendsChart);
        document.getElementById('breakdownYear').addEventListener('change', updateBreakdownChart);
        document.getElementById('forecastType').addEventListener('change', updateForecastChart);
        
        // Export functions
        document.getElementById('exportPDF').addEventListener('click', exportToPDF);
        document.getElementById('exportExcel').addEventListener('click', exportToExcel);
    }

    function handleYearChange() {
        const primaryYear = document.getElementById('primaryYear').value;
        const compareYear = document.getElementById('compareYear').value;
        
        updateMetricsForYear(primaryYear, compareYear);
    }

    function updateAnalytics() {
        showNotification('Updating analytics with selected years...');
        
        const primaryYear = document.getElementById('primaryYear').value;
        const compareYear = document.getElementById('compareYear').value;
        
        updateMetricsForYear(primaryYear, compareYear);
        updateTrendsChart();
        updateBreakdownChart();
        updateForecastChart();
        
        setTimeout(() => {
            showNotification('Analytics updated successfully');
        }, 1000);
    }

    function updateMetricsForYear(primaryYear, compareYear = null) {
        const primaryData = historicalData[primaryYear];
        const compareData = compareYear ? historicalData[compareYear] : null;
        
        // Update total incidents
        document.getElementById('totalIncidents').textContent = primaryData.total_crimes.toLocaleString();
        document.getElementById('totalIncidentsYear').textContent = primaryYear;
        
        if (compareData) {
            const change = ((primaryData.total_crimes - compareData.total_crimes) / compareData.total_crimes * 100);
            document.getElementById('totalIncidentsDetail').textContent = 
                `${primaryData.total_crimes.toLocaleString()} vs ${compareData.total_crimes.toLocaleString()} previous year (${change > 0 ? '+' : ''}${change.toFixed(1)}%)`;
            document.getElementById('totalCrimesChange').textContent = `${change > 0 ? '+' : ''}${change.toFixed(0)}%`;
            
            const trendElement = document.getElementById('totalCrimesTrend');
            trendElement.className = `trend-indicator ${change < 0 ? 'down' : 'up'}`;
            trendElement.querySelector('i').className = `fas fa-arrow-${change < 0 ? 'down' : 'up'}`;
        }
        
        // Update homicides
        document.getElementById('totalHomicides').textContent = primaryData.homicides;
        document.getElementById('homicidesYear').textContent = primaryYear;
        
        if (compareData) {
            const homicideChange = ((primaryData.homicides - compareData.homicides) / compareData.homicides * 100);
            document.getElementById('homicidesDetail').textContent = 
                `${primaryData.homicides} vs ${compareData.homicides} previous year (${homicideChange > 0 ? '+' : ''}${homicideChange.toFixed(1)}%)`;
            document.getElementById('homicidesChange').textContent = `${homicideChange > 0 ? '+' : ''}${homicideChange.toFixed(0)}%`;
        }
        
        // Update response time
        document.getElementById('responseTime').textContent = primaryData.response_time.toFixed(1);
        
        if (compareData) {
            const responseChange = ((primaryData.response_time - compareData.response_time) / compareData.response_time * 100);
            document.getElementById('responseChange').textContent = `${responseChange > 0 ? '+' : ''}${responseChange.toFixed(0)}%`;
        }
        
        // Update clearance rate
        document.getElementById('clearanceRate').textContent = `${primaryData.clearance_rate}%`;
        
        if (compareData) {
            const clearanceChange = ((primaryData.clearance_rate - compareData.clearance_rate) / compareData.clearance_rate * 100);
            document.getElementById('clearanceChange').textContent = `${clearanceChange > 0 ? '+' : ''}${clearanceChange.toFixed(0)}%`;
        }
    }

    function initializeMultiYearTrendsChart() {
        const ctx = document.getElementById('multiYearTrendsChart').getContext('2d');
        
        const years = Object.keys(historicalData).sort();
        const totalCrimesData = years.map(year => historicalData[year].total_crimes);
        
        multiYearTrendsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: years,
                datasets: [{
                    label: 'Total Crimes',
                    data: totalCrimesData,
                    borderColor: '#00A651',
                    backgroundColor: 'rgba(0, 166, 81, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#00A651',
                    pointBorderColor: '#00C760',
                    pointBorderWidth: 2,
                    pointRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#FFFFFF',
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#CCCCCC' },
                        grid: { color: 'rgba(0, 166, 81, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#CCCCCC' },
                        grid: { color: 'rgba(0, 166, 81, 0.1)' }
                    }
                }
            }
        });
    }

    function updateTrendsChart() {
        const trendType = document.getElementById('trendType').value;
        const years = Object.keys(historicalData).sort();
        
        let data, label, color;
        
        switch(trendType) {
            case 'violent':
                data = years.map(year => historicalData[year].violent_crimes);
                label = 'Violent Crimes';
                color = '#E31E24';
                break;
            case 'property':
                data = years.map(year => historicalData[year].property_crimes);
                label = 'Property Crimes';
                color = '#FFD700';
                break;
            case 'drug':
                data = years.map(year => historicalData[year].drug_offenses);
                label = 'Drug Offenses';
                color = '#9D4EDD';
                break;
            case 'homicides':
                data = years.map(year => historicalData[year].homicides);
                label = 'Homicides';
                color = '#E31E24';
                break;
            default:
                data = years.map(year => historicalData[year].total_crimes);
                label = 'Total Crimes';
                color = '#00A651';
        }
        
        multiYearTrendsChart.data.datasets[0].data = data;
        multiYearTrendsChart.data.datasets[0].label = label;
        multiYearTrendsChart.data.datasets[0].borderColor = color;
        multiYearTrendsChart.data.datasets[0].backgroundColor = color + '20';
        multiYearTrendsChart.data.datasets[0].pointBackgroundColor = color;
        
        multiYearTrendsChart.update();
    }

    function initializeCrimeBreakdownChart() {
        const ctx = document.getElementById('crimeBreakdownChart').getContext('2d');
        
        const data2024 = historicalData['2024'];
        
        crimeBreakdownChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Violent Crimes', 'Property Crimes', 'Drug Offenses', 'Fraud', 'Theft', 'Sexual Offenses'],
                datasets: [{
                    data: [
                        data2024.violent_crimes,
                        data2024.property_crimes,
                        data2024.drug_offenses,
                        data2024.fraud,
                        data2024.theft,
                        data2024.sexual_offenses
                    ],
                    backgroundColor: [
                        '#E31E24',
                        '#FFD700',
                        '#9D4EDD',
                        '#00A651',
                        '#FFA500',
                        '#00C760'
                    ],
                    borderWidth: 3,
                    borderColor: '#000000'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#FFFFFF',
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                }
            }
        });
    }

    function updateBreakdownChart() {
        const year = document.getElementById('breakdownYear').value;
        const data = historicalData[year];
        
        crimeBreakdownChart.data.datasets[0].data = [
            data.violent_crimes,
            data.property_crimes,
            data.drug_offenses,
            data.fraud,
            data.theft,
            data.sexual_offenses
        ];
        
        crimeBreakdownChart.update();
    }

    function initializeCrimeForecast() {
        const ctx = document.getElementById('crimeForecastChart').getContext('2d');
        
        const historicalYears = Object.keys(historicalData).sort();
        const historicalValues = historicalYears.map(year => historicalData[year].total_crimes);
        
        const forecastYears = ['2025', '2026'];
        const trend = (historicalValues[historicalValues.length - 1] - historicalValues[0]) / (historicalValues.length - 1);
        const forecastValues = forecastYears.map((year, index) => {
            return Math.round(historicalValues[historicalValues.length - 1] + trend * (index + 1));
        });
        
        crimeForecastChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [...historicalYears, ...forecastYears],
                datasets: [
                    {
                        label: 'Historical Data',
                        data: [...historicalValues, ...Array(forecastYears.length).fill(null)],
                        borderColor: '#00A651',
                        backgroundColor: 'rgba(0, 166, 81, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Forecast',
                        data: [...Array(historicalYears.length - 1).fill(null), historicalValues[historicalValues.length - 1], ...forecastValues],
                        borderColor: '#00C760',
                        backgroundColor: 'rgba(0, 199, 96, 0.1)',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#FFFFFF',
                            usePointStyle: true
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#CCCCCC' },
                        grid: { color: 'rgba(0, 166, 81, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#CCCCCC' },
                        grid: { color: 'rgba(0, 166, 81, 0.1)' }
                    }
                }
            }
        });
    }

    function updateForecastChart() {
        const forecastType = document.getElementById('forecastType').value;
        const years = Object.keys(historicalData).sort();
        
        let data, label;
        
        switch(forecastType) {
            case 'violent':
                data = years.map(year => historicalData[year].violent_crimes);
                label = 'Violent Crimes';
                break;
            case 'homicides':
                data = years.map(year => historicalData[year].homicides);
                label = 'Homicides';
                break;
            default:
                data = years.map(year => historicalData[year].total_crimes);
                label = 'Total Crimes';
        }
        
        const trend = (data[data.length - 1] - data[0]) / (data.length - 1);
        const forecastValues = [2025, 2026].map((year, index) => {
            return Math.round(data[data.length - 1] + trend * (index + 1));
        });
        
        crimeForecastChart.data.datasets[0].data = [...data, null, null];
        crimeForecastChart.data.datasets[0].label = `Historical ${label}`;
        crimeForecastChart.data.datasets[1].data = [...Array(years.length - 1).fill(null), data[data.length - 1], ...forecastValues];
        crimeForecastChart.data.datasets[1].label = `${label} Forecast`;
        
        crimeForecastChart.update();
    }

    function initializeMetricCharts() {
        const years = Object.keys(historicalData).sort().slice(-6);
        
        createMiniChart('totalIncidentsChart', years.map(y => historicalData[y].total_crimes), '#00A651');
        createMiniChart('homicidesChart', years.map(y => historicalData[y].homicides), '#E31E24');
        createMiniChart('responseChart', years.map(y => historicalData[y].response_time), '#FFD700');
        createMiniChart('clearanceChart', years.map(y => historicalData[y].clearance_rate), '#00A651');
    }

    function createMiniChart(canvasId, data, color) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map((_, i) => i),
                datasets: [{
                    data: data,
                    borderColor: color,
                    backgroundColor: color + '20',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { display: false }
                },
                elements: { point: { radius: 0 } }
            }
        });
    }

    function switchComparisonView(event) {
        document.querySelectorAll('.comparison-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        const view = event.target.dataset.view;
        
        document.querySelectorAll('.comparison-view').forEach(view => view.classList.remove('active'));
        document.getElementById(view + 'View').classList.add('active');
    }

    function updateCrimesTable() {
        const tableBody = document.getElementById('crimesTableBody');
        tableBody.innerHTML = '';
        
        const crimeTypes = [
            { key: 'violent_crimes', name: 'Violent Crimes', icon: 'fas fa-fist-raised' },
            { key: 'property_crimes', name: 'Property Crimes', icon: 'fas fa-home' },
            { key: 'drug_offenses', name: 'Drug Offenses', icon: 'fas fa-pills' },
            { key: 'fraud', name: 'Fraud', icon: 'fas fa-credit-card' },
            { key: 'theft', name: 'Theft', icon: 'fas fa-mask' },
            { key: 'sexual_offenses', name: 'Sexual Offenses', icon: 'fas fa-exclamation' }
        ];
        
        crimeTypes.forEach(type => {
            const row = document.createElement('tr');
            const change5yr = ((historicalData['2024'][type.key] - historicalData['2020'][type.key]) / historicalData['2020'][type.key] * 100);
            
            row.innerHTML = `
                <td class="crime-type">
                    <i class="${type.icon}"></i>
                    ${type.name}
                </td>
                <td>${historicalData['2024'][type.key]}</td>
                <td>${historicalData['2023'][type.key]}</td>
                <td>${historicalData['2022'][type.key]}</td>
                <td>${historicalData['2021'][type.key]}</td>
                <td>${historicalData['2020'][type.key]}</td>
                <td class="change-percent ${change5yr < 0 ? 'down' : 'up'}">
                    ${change5yr > 0 ? '+' : ''}${change5yr.toFixed(1)}%
                </td>
            `;
            
            tableBody.appendChild(row);
        });
    }

    function updateLastUpdateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById('lastUpdateTime').textContent = timeString;
    }

    function loadInitialData() {
        showNotification('Loading multi-year crime data...');
        
        setTimeout(() => {
            updateCrimesTable();
            showNotification('Multi-year analytics data loaded successfully');
        }, 1500);
    }

    function exportToPDF() {
        showNotification('Generating PDF report...');
    }

    function exportToExcel() {
        showNotification('Exporting to Excel...');
    }

    // Auto-refresh every 5 minutes
    setInterval(updateLastUpdateTime, 60000);

    console.log('Enhanced Multi-Year Analytics Dashboard Ready');
    console.log('Historical data: 2016-2024');
    console.log('Multi-year comparison: ENABLED');
</script>
{% endblock %}

{% block scripts %}
<script>
console.log('Crime Analytics Dashboard page loaded successfully');
</script>
{% endblock %}